{
  "01_find_callers": {
    "description": "Who calls validate_token?",
    "query": "refs validate_token --kind calls",
    "expected": [
      {"source": "get_current_user", "file": "auth/service.py"},
      {"source": "change_password", "file": "auth/service.py"},
      {"source": "refresh_token", "file": "auth/tokens.py"},
      {"source": "wrapper", "file": "auth/middleware.py"},
      {"source": "get_current_user", "file": "auth/middleware.py"}
    ]
  },
  "02_file_structure": {
    "description": "What's in auth/service.py?",
    "query": "outline auth/service.py",
    "expected": [
      {"name": "BaseService", "kind": "class"},
      {"name": "__init__", "kind": "method"},
      {"name": "_log", "kind": "method"},
      {"name": "AuthService", "kind": "class"},
      {"name": "__init__", "kind": "method"},
      {"name": "login", "kind": "method"},
      {"name": "logout", "kind": "method"},
      {"name": "get_current_user", "kind": "method"},
      {"name": "_find_user", "kind": "method"},
      {"name": "change_password", "kind": "method"},
      {"name": "AdminService", "kind": "class"},
      {"name": "impersonate", "kind": "method"},
      {"name": "list_all_users", "kind": "method"}
    ]
  },
  "03_refactor_impact": {
    "description": "Impact of changing AuthService",
    "query": "impact AuthService --depth 3",
    "expected_refs": [
      "AdminService",
      "__init__",
      "routes/auth.py",
      "routes/admin.py"
    ]
  },
  "04_class_hierarchy": {
    "description": "Hierarchy of BaseService",
    "query": "hierarchy BaseService",
    "expected": [
      {"child": "AuthService", "parent": "BaseService"}
    ],
    "note": "AdminService inherits AuthService not BaseService directly; use hierarchy AuthService to find it"
  },
  "05_trace_call_chain": {
    "description": "Trace login_route call chain",
    "query_sequence": [
      "callees login_route",
      "callees login",
      "callees generate_token"
    ],
    "expected_chain": [
      {"caller": "login_route", "callee": "login"},
      {"caller": "login", "callee": "generate_token"},
      {"caller": "login", "callee": "_find_user"},
      {"caller": "generate_token", "callee": "Session.create"}
    ]
  },
  "06_file_deps": {
    "description": "What does routes/auth.py import?",
    "query": "deps routes/auth.py",
    "expected": [
      "AuthService",
      "auth_required",
      "extract_token",
      "get_logger"
    ]
  },
  "07_type_references": {
    "description": "Type references in Python (decorators, exception types)",
    "query": "refs TokenError",
    "expected": [
      {"source": "ExpiredTokenError", "file": "auth/tokens.py", "kind": "inherits"},
      {"source": "InvalidScopeError", "file": "auth/tokens.py", "kind": "inherits"},
      {"source": "validate_token", "file": "auth/tokens.py", "kind": "raises"},
      {"source": "validate_token", "file": "auth/tokens.py", "kind": "calls"},
      {"source": "auth.tokens", "file": "auth/middleware.py", "kind": "imports"},
      {"source": "get_current_user", "file": "auth/middleware.py", "kind": "references"}
    ]
  }
}
